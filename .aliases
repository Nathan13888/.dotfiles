#########################
#         ALIAS         #
#########################

function exp-path() {
  SEL="$(readlink -f $1)"
  export PATH="$PATH:$SEL"
}

eval "$(pay-respects zsh --alias)"

# Linux-specific aliases (networking, system tools, benchmarks)
[ -f ~/.aliases.linux ] && source ~/.aliases.linux

### CLI & APPLICATIONS
exportvar () {
  readonly NAME=${1:?"Specify the name of the variable"}
  read VALUE
  export $NAME="$VALUE"
}
alias s="sudo"
alias sudo='sudo ' # for using other alias when using sudo
function reload {
  if [[ $SHELL == */tmux ]] ; then
    exec zsh
  else
    exec $SHELL
  fi
}
alias ar="paru"
alias tm="tmux"
alias tma="tmux attach"
alias tmr="tmux source-file ~/.tmux.conf"
alias tmks="tmux kill-server"
if command -v nvim &> /dev/null; then
    alias v="nvim"
else
    alias v="vim"
fi
alias sv='sudo v'

alias g="git"
git-inspect-status() {
  for f in ./*; do;
    if [ -d "$f" ]; then
      echo $f
      git -C $f status -sb
    fi
  done
}
alias n="npm"
alias nx="npx"
alias p="pnpm"
alias px="pnpm dlx"
alias pr="pnpm run"
alias b="bun"
alias bx="bunx"
alias k="kubectl"
alias m="micromamba"
alias h="helm"
alias py="python"
alias vr='v -r'
alias vm="v -M"
alias su="sudo su -"
alias c="cd"
alias clear='printf "\ec"'
alias cc="claude --dangerously-skip-permissions --permission-mode plan"
alias y="yazi"

### NETWORKING
alias ifa="/sbin/ifconfig -a"

alias pg="pgrep"
alias grep="grep --color=always"
function GI {
  grep -i "$@"
}
function TC {
  tr -s ' ' | cut -d " " -f$1
}
function sedhref {
  sed -n 's/.*href="\([^"]*\).*/\1/p'
}
alias count="wc -l"

### APPLICATIONS
alias mpv="mpv --hwdec=auto"

function flash {
    readonly source=${1:?"Source ISO must be specified"}
    readonly target=${2:?"Target Device must be specified"}
    sudo dd bs=4M if=$source of=$target status=progress "${@:3}"
}

### FS
sf () {
    sshfs -o allow_other "$@"
}
alias ssh-check="ssh -O check"
alias fdisk="sudo fdisk"
alias mount="sudo mount"
alias umount="sudo umount"

alias fdd='find . -type d -name' # find directory
alias fff='find . -type f -name' # find file
alias du="du -h"
alias df="df -h"
alias du1="du -d 1"
dutop() {
  SOURCE=$1
  if [ SOURCE=="" ]; then
    du -hsx -- * | sort -rh | head -10
  else
    du -hsx -- $SOURCE | sort -rh | head -10
  fi
}
tdur() {
    local P="$1"
    if [ -z "$P" ]; then
        echo -e "No path specified. Scanning all contents of working directory.\n\n"
        return 1
    else
        echo -e "Using path specified: '$P'\n\n"
    fi
    exiftool -n -p '\${Duration;our\$s;\$_=ConvertDuration(\$s+=\$_)}' $P|tail -n1
}
alias stripexif="exiftool -all:all= -tagsfromfile @ -exif:Orientation"

##### LS
if command -v eza &> /dev/null; then
    alias ls="eza -@ --time-style iso --octal-permissions --no-permissions"
elif command -v exa &> /dev/null; then
    alias ls="exa -@ --time-style iso --octal-permissions --no-permissions"
fi
alias la='ls -alhg --color=always --group-directories-first'
alias lag="la | grep --color=always ''"
alias lad="la | grep --color=always '^d'"
alias laf="la | grep --color=always '^-'"
alias lar="ls -R --color=always"
alias lal="la | less"

### FILE OPERATIONS
alias remount="sudo mount -av"
alias chmox='sudo chmod +x'
alias chowm="sudo chown $USER:$USER -v"
alias mkd="mkdir -vp"
alias smkd="sudo mkdir -vp"

alias rs='rsync -avPhh --info=progress2,stats1 --partial'

function wgt {
  NSLASH="$(echo "$1" | perl -pe 's|.*://[^/]+(.*?)/?$|\1|' | grep -o / | wc -l)"
  NCUT=$((NSLASH > 0 ? NSLASH-1 : 0))
  wget -r -c -np -e robots=off --user-agent=Mozilla/5.0 -nH --relative --cut-dirs=$NCUT -R "index.html*" "$@"
}

alias ydl="yt-dlp"
ydl-video () {
  ydl -f "bestvideo[height>=720]+bestaudio/best" -ciw -o "%(title)s.%(ext)s" -v --merge-output-format=mkv "$@"
}
ydl-audio () {
  ydl --extract-audio --audio-format mp3 --audio-quality 0 "$@"
}
ydl-archive () {
  ydl-video --write-annotations --write-description --write-info-json --write-all-thumbnails --download-archive downloaded.txt "$@"
}

m3u8-prompt () {
  echo "Enter m3u8 link:";read link;echo "Enter output filename:";read filename;ffmpeg -i "$link" -bsf:a aac_adtstoasc -vcodec copy -c copy -crf 50 $filename.mp4
}

function tarp {
  readonly source=${1:?"The SOURCE must be specified"}
  readonly target=${2:?"The TARGET must be specified"}
  program="$3"
  if [ -z ${3+x} ]; then
  	program="pigz -k -6"
  fi
  echo -e "Using compress program command '$program'\n"
  tar --use-compress-program="$program" -cf - -C "$source" . | pv > "$target"
}

alias cp='cp -v'
alias mv='mv -v'
alias rm='rm -v'
alias rmf='rm -f'
alias rmd="rmdir -v"

### CD
alias ..="cd .."
alias ...="cd ../.."
alias .3='cd ../../..'
alias .4='cd ../../../..'
alias .5='cd ../../../../..'
alias 1='cd -'
alias 2='cd -2'
alias 3='cd -3'
